DEFINITION MODULE UTF8;

(* This module implements UTF-8 utility procedures. *)

PROCEDURE UTF8CharLen(firstByte: CHAR): CARDINAL;
(* Returns the number of bytes in a UTF-8 character starting with firstByte *)

PROCEDURE IsValidUTF8(buf: ARRAY OF CHAR; len: CARDINAL): BOOLEAN;
(* Returns TRUE if buf[0..len-1] is valid UTF-8 *)

PROCEDURE SkipBOM(VAR buf: ARRAY OF CHAR; VAR len: CARDINAL);
(* If BOM is present at start, advances buf/len past it *)

PROCEDURE CodePointToUTF8(codePoint: CARDINAL; VAR buffer: ARRAY OF CHAR; VAR bytesWritten: CARDINAL): BOOLEAN;
(* Converts a Unicode code point to UTF-8 and writes it to buffer.
   Returns TRUE if successful, FALSE if the code point is invalid or buffer is too small. *)

END UTF8.